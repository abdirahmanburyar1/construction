(()=>{var e={};e.id=290,e.ids=[290],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},86754:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),a(58614),a(90965),a(8415),a(81163),a(35866),a(32029);var r=a(23191),n=a(88716),s=a(37922),i=a.n(s),l=a(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let d=["",{children:["(tenant)",{children:["(app)",{children:["expenses",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,58614)),"C:\\construction\\src\\app\\(tenant)\\(app)\\expenses\\new\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,90965)),"C:\\construction\\src\\app\\(tenant)\\(app)\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,8415)),"C:\\construction\\src\\app\\(tenant)\\layout.tsx"],error:[()=>Promise.resolve().then(a.bind(a,81163)),"C:\\construction\\src\\app\\(tenant)\\error.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,32029)),"C:\\construction\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\construction\\src\\app\\(tenant)\\(app)\\expenses\\new\\page.tsx"],u="/(tenant)/(app)/expenses/new/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(tenant)/(app)/expenses/new/page",pathname:"/expenses/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},13697:(e,t,a)=>{let r={c836c9d73feae8b3a4f73009e94fc74adf313489:()=>Promise.resolve().then(a.bind(a,85070)).then(e=>e.createExpenseAction),"2b4dd5eb7f67e7f5c4ddb6afd53120597cfafbe4":()=>Promise.resolve().then(a.bind(a,94635)).then(e=>e.createMaterialAction),"3b5e7cf91495eec4540062b08cad32ac116c81f6":()=>Promise.resolve().then(a.bind(a,94635)).then(e=>e.createMaterialAndReturnAction),"76d2f7eab5a9ca694568750b7c6072710bf776bc":()=>Promise.resolve().then(a.bind(a,47781)).then(e=>e.tenantLogoutAction),eb199951dc64bdcf56efddeb38a43d32f737683e:()=>Promise.resolve().then(a.bind(a,47781)).then(e=>e.tenantLoginAction)};async function n(e,...t){return(await r[e]()).apply(null,t)}e.exports={c836c9d73feae8b3a4f73009e94fc74adf313489:n.bind(null,"c836c9d73feae8b3a4f73009e94fc74adf313489"),"2b4dd5eb7f67e7f5c4ddb6afd53120597cfafbe4":n.bind(null,"2b4dd5eb7f67e7f5c4ddb6afd53120597cfafbe4"),"3b5e7cf91495eec4540062b08cad32ac116c81f6":n.bind(null,"3b5e7cf91495eec4540062b08cad32ac116c81f6"),"76d2f7eab5a9ca694568750b7c6072710bf776bc":n.bind(null,"76d2f7eab5a9ca694568750b7c6072710bf776bc"),eb199951dc64bdcf56efddeb38a43d32f737683e:n.bind(null,"eb199951dc64bdcf56efddeb38a43d32f737683e")}},41637:(e,t,a)=>{Promise.resolve().then(a.bind(a,68142))},68142:(e,t,a)=>{"use strict";a.d(t,{ExpenseForm:()=>g});var r=a(10326),n=a(60962),s=a(17577),i=a(90434);a(15424);var l=(0,a(46242).$)("c836c9d73feae8b3a4f73009e94fc74adf313489"),o=a(74715),d=a(27532),c=a(50028);let u="__add_new_category__";function m({category:e,categories:t,onCategoryChange:a,onCancel:s}){let{pending:i}=(0,n.useFormStatus)();return(0,r.jsxs)("fieldset",{disabled:i,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"add-material-name",className:"mb-1 block text-sm font-medium text-slate-700",children:"Material name"}),r.jsx("input",{id:"add-material-name",name:"name",required:!0,className:"input w-full",placeholder:"e.g. Cement, Steel rebar"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"add-material-category",className:"mb-1 block text-sm font-medium text-slate-700",children:"Category"}),(0,r.jsxs)("select",{id:"add-material-category",value:e,onChange:a,className:"input w-full","aria-label":"Category",children:[r.jsx("option",{value:"",children:"Select category (optional)"}),t.map(e=>r.jsx("option",{value:e,children:e},e)),r.jsx("option",{value:u,children:"+ Add new category"})]}),r.jsx("input",{type:"hidden",name:"category",value:e})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"add-material-unit",className:"mb-1 block text-sm font-medium text-slate-700",children:"Unit"}),r.jsx("input",{id:"add-material-unit",name:"unit",required:!0,className:"input w-full",placeholder:"e.g. kg, m\xb2, bags"})]}),(0,r.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,r.jsxs)("button",{type:"submit",className:"btn btn-primary inline-flex items-center gap-2",disabled:i,children:[i&&(0,r.jsxs)("svg",{className:"h-4 w-4 shrink-0 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":!0,children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i?"Adding…":"Add material"]}),r.jsx("button",{type:"button",onClick:s,disabled:i,className:"btn btn-secondary",children:"Cancel"})]})]})}function p({value:e,onChange:t,onConfirm:a,onCancel:n,onBackdropClick:s}){return r.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"new-category-title-inline",onClick:s,children:(0,r.jsxs)("div",{className:"w-full max-w-sm rounded-xl border border-slate-200 bg-white p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{id:"new-category-title-inline",className:"text-lg font-semibold text-slate-800",children:"New category"}),r.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Enter a category name. It will be saved with this material."}),r.jsx("input",{type:"text",value:e,onChange:e=>t(e.target.value),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),a()),placeholder:"e.g. Concrete, Steel, Electrical",className:"input mt-4 w-full",autoFocus:!0}),(0,r.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[r.jsx("button",{type:"button",onClick:n,className:"btn btn-secondary",children:"Cancel"}),r.jsx("button",{type:"button",onClick:a,disabled:!e.trim(),className:"btn btn-primary disabled:opacity-50",children:"Use this category"})]})]})})}function x({initialCategories:e=[],onSuccess:t,onClose:a}){let[i,l]=(0,n.useFormState)(c.t,null);(0,d.Q)(i&&"error"in i?i:null);let[o,x]=(0,s.useState)(""),[h,b]=(0,s.useState)(e),[f,g]=(0,s.useState)(!1),[y,j]=(0,s.useState)("");(0,s.useRef)(void 0);let w=(0,s.useCallback)(e=>{let t=e.target.value;if(t===u){g(!0);return}x(t)},[]),v=(0,s.useCallback)(()=>{g(!1),j("")},[]),N=(0,s.useCallback)(()=>{let e=y.trim();e&&(h.includes(e)||b(t=>[...t,e].sort((e,t)=>e.localeCompare(t))),x(e),v())},[y,h,v]),C=(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",role:"dialog","aria-modal":"true","aria-labelledby":"add-material-title",onClick:a,children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{id:"add-material-title",className:"text-lg font-semibold text-slate-800",children:"Add new material"}),r.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Add a material to the catalog. It will be selected for this row."}),r.jsx("form",{action:l,className:"mt-6",onSubmit:e=>e.stopPropagation(),children:r.jsx(m,{category:o,categories:h,onCategoryChange:w,onCancel:a})})]})}),f&&r.jsx(p,{value:y,onChange:j,onConfirm:N,onCancel:v,onBackdropClick:v})]});return"undefined"!=typeof document?(0,n.createPortal)(C,document.body):null}function h(){let{pending:e}=(0,n.useFormStatus)();return(0,r.jsxs)("button",{type:"submit",className:"btn btn-primary inline-flex items-center gap-2",disabled:e,children:[e&&(0,r.jsxs)("svg",{className:"h-4 w-4 shrink-0 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":!0,children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e?"Adding…":"Add expense"]})}let b="__add_new_material__";function f(){return Math.random().toString(36).slice(2,11)}function g({projects:e,materials:t,defaultProjectId:a}){let[c,u]=(0,n.useFormState)(l,null);(0,d.Q)(c);let[m,p]=(0,s.useState)(a??""),[g,y]=(0,s.useState)(t),[j,w]=(0,s.useState)([{id:f(),materialId:"",qty:"",unitPrice:""}]),[v,N]=(0,s.useState)(!1),[C,P]=(0,s.useState)(null),k=e.map(e=>({value:e.id,label:e.name})),A=(0,s.useMemo)(()=>g.map(e=>({value:e.id,label:`${e.name} (${e.unit})${e.category?` \xb7 ${e.category}`:""}`})),[g]),I=(0,s.useMemo)(()=>Array.from(new Set(g.map(e=>e.category).filter(Boolean))).sort(),[g]),_=(0,s.useCallback)(e=>{let t=new Set(j.filter(t=>t.id!==e&&t.materialId).map(e=>e.materialId)),a=j.find(t=>t.id===e)?.materialId;return[...A.filter(e=>e.value===a||!t.has(e.value)),{value:b,label:"+ Add new material"}]},[j,A]),q=(0,s.useCallback)(()=>{w(e=>[...e,{id:f(),materialId:"",qty:"",unitPrice:""}])},[]),S=(0,s.useCallback)(e=>{w(t=>t.length>1?t.filter(t=>t.id!==e):t)},[]),F=(0,s.useCallback)((e,t,a)=>{w(r=>{let n=r.map(r=>r.id===e?{...r,[t]:a}:r);if("materialId"!==t)return n;let s=n.findIndex(t=>t.id===e);if(s<0||s>=n.length-1)return n;let i=n[s+1];return!i.materialId&&(""===i.qty||Number.isNaN(parseFloat(i.qty))||0===parseFloat(i.qty))&&(""===i.unitPrice||Number.isNaN(parseFloat(i.unitPrice))||0===parseFloat(i.unitPrice))&&n.length>1?n.filter(e=>e.id!==i.id):n})},[]),M=(0,s.useCallback)((e,t)=>{if(t===b){P(e),N(!0);return}F(e,"materialId",t)},[F]),$=(0,s.useCallback)(e=>{y(t=>[...t,e]),C&&F(C,"materialId",e.id),P(null),N(!1)},[C,F]),E=(e,t)=>{let a=parseFloat(e),r=parseFloat(t);return Number.isNaN(a)||Number.isNaN(r)?"":(a*r).toFixed(2)},D="w-full min-w-0 border-0 border-b border-slate-300 bg-transparent px-0 py-1.5 text-sm focus:border-teal-500 focus:outline-none focus:ring-0";return(0,r.jsxs)("form",{action:u,className:"max-w-4xl space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"projectId",className:"mb-1 block text-sm font-medium text-slate-700",children:"Project"}),r.jsx(o.V,{name:"projectId",value:m,onChange:p,options:k,placeholder:"Select project",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"expenseDate",className:"mb-1 block text-sm font-medium text-slate-700",children:"Date"}),r.jsx("input",{id:"expenseDate",name:"expenseDate",type:"date",required:!0,className:"input w-full",defaultValue:new Date().toISOString().slice(0,10)})]})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"mb-2",children:r.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Items"})}),r.jsx("div",{className:"table-wrap border-0 shadow-none",children:(0,r.jsxs)("table",{children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"Material"}),r.jsx("th",{children:"Qty"}),r.jsx("th",{children:"Unit price"}),r.jsx("th",{children:"Total"}),r.jsx("th",{className:"w-24"})]})}),r.jsx("tbody",{children:j.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"min-w-[140px]",children:r.jsx(o.V,{name:"materialId",value:e.materialId,onChange:t=>M(e.id,t),options:_(e.id),placeholder:"Select material",required:!0,className:"min-w-[140px]",inputClassName:D+" min-w-[140px] cursor-pointer rounded-none"})}),r.jsx("td",{className:"min-w-[80px]",children:r.jsx("input",{name:"qty",type:"number",step:"0.0001",min:"0",className:D,placeholder:"0",value:e.qty,onChange:t=>F(e.id,"qty",t.target.value)})}),r.jsx("td",{className:"min-w-[90px]",children:r.jsx("input",{name:"unitPrice",type:"number",step:"0.01",min:"0",className:D,placeholder:"0.00",value:e.unitPrice,onChange:t=>F(e.id,"unitPrice",t.target.value)})}),r.jsx("td",{className:"text-slate-600 font-medium",children:E(e.qty,e.unitPrice)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(parseFloat(E(e.qty,e.unitPrice))):"—"}),r.jsx("td",{className:"w-24",children:(0,r.jsxs)("span",{className:"flex items-center justify-center gap-0.5",children:[r.jsx("button",{type:"button",onClick:q,className:"flex items-center justify-center rounded p-1.5 text-slate-400 transition-colors hover:bg-slate-100 hover:text-teal-600","aria-label":"Add row",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:[r.jsx("path",{d:"M5 12h14"}),r.jsx("path",{d:"M12 5v14"})]})}),r.jsx("button",{type:"button",onClick:()=>S(e.id),className:"flex items-center justify-center rounded p-1.5 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-600","aria-label":"Remove row",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-5 w-5",children:[r.jsx("path",{d:"M3 6h18"}),r.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),r.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),r.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),r.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})})]})})]},e.id))})]})}),0===g.length&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-amber-600",children:['No materials in catalog. Use "+ Add new material" in the dropdown or ',r.jsx(i.default,{href:"/materials/new",className:"underline",children:"add materials"})," first."]})]}),v&&r.jsx(x,{initialCategories:I,onSuccess:$,onClose:()=>{N(!1),P(null)}}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(h,{}),r.jsx(i.default,{href:"/expenses",className:"btn btn-secondary",children:"Cancel"})]})]})}},50028:(e,t,a)=>{"use strict";a.d(t,{$:()=>s,t:()=>n}),a(15424);var r=a(46242),n=(0,r.$)("3b5e7cf91495eec4540062b08cad32ac116c81f6"),s=(0,r.$)("2b4dd5eb7f67e7f5c4ddb6afd53120597cfafbe4")},74715:(e,t,a)=>{"use strict";a.d(t,{V:()=>i});var r=a(10326),n=a(17577),s=a(60962);function i({name:e,value:t,onChange:a,options:i,placeholder:l="Search...",required:o=!1,className:d="",inputClassName:c=""}){let[u,m]=(0,n.useState)(!1),[p,x]=(0,n.useState)(""),[h,b]=(0,n.useState)(null),f=(0,n.useRef)(null),g=(0,n.useRef)(null),y=(0,n.useId)(),j=(0,n.useRef)(null),w=i.find(e=>e.value===t),v=w?.label??"",N=""===p.trim()?i:i.filter(e=>e.label.toLowerCase().includes(p.toLowerCase())),C=e=>{a(e.value),x(""),m(!1)},P=u?r.jsx("ul",{ref:j,id:y,role:"listbox",className:"max-h-48 overflow-auto rounded-lg border border-slate-200 bg-white py-1 shadow-lg",style:h?{position:"fixed",top:h.top,left:h.left,width:h.width,zIndex:9999}:void 0,children:0===N.length?r.jsx("li",{className:"px-3 py-2 text-sm text-slate-500",children:"No matches"}):N.map(e=>r.jsx("li",{role:"option","aria-selected":e.value===t,className:`cursor-pointer px-3 py-2 text-sm hover:bg-slate-100 ${e.value===t?"bg-teal-50 text-teal-800":"text-slate-800"}`,onClick:()=>C(e),children:e.label},e.value))}):null;return(0,r.jsxs)("div",{ref:f,className:`relative ${d}`,children:[r.jsx("input",{type:"hidden",name:e,value:t,readOnly:!0,required:o}),(0,r.jsxs)("div",{ref:g,role:"combobox","aria-expanded":u,"aria-haspopup":"listbox","aria-controls":y,id:`${e}-combobox-${y}`,className:`relative flex min-h-[38px] w-full cursor-pointer items-center rounded-lg border border-slate-300 bg-white px-3 py-2 pr-9 text-sm focus:border-teal-500 focus:outline-none focus:ring-1 focus:ring-teal-500 ${c}`,onClick:()=>m(!u),children:[u?r.jsx("input",{type:"text",autoFocus:!0,value:p,onChange:e=>x(e.target.value),onKeyDown:e=>{"Escape"===e.key&&m(!1),"Enter"===e.key&&N[0]&&C(N[0])},placeholder:l,className:"min-w-0 flex-1 bg-transparent pr-2 focus:outline-none",onClick:e=>e.stopPropagation(),"aria-autocomplete":"list","aria-controls":y}):r.jsx("span",{className:`min-w-0 flex-1 truncate ${t?"text-slate-900":"text-slate-500"}`,children:v||l}),r.jsx("span",{className:"pointer-events-none absolute right-2 top-1/2 flex h-5 w-5 -translate-y-1/2 items-center justify-center text-slate-400","aria-hidden":!0,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`h-4 w-4 transition-transform duration-200 ${u?"rotate-180":""}`,children:r.jsx("path",{d:"m6 9 6 6 6-6"})})})]}),"undefined"!=typeof document&&P&&(0,s.createPortal)(P,document.body)]})}},27532:(e,t,a)=>{"use strict";function r(e){}a.d(t,{Q:()=>r}),a(17577),a(12919)},85070:(e,t,a)=>{"use strict";a.r(t),a.d(t,{createExpenseAction:()=>o});var r=a(27745);a(26461);var n=a(74739),s=a(30207),i=a(28516),l=a(24831);async function o(e,t){let a=await (0,i.n)(),r=t.get("projectId")?.trim(),o=t.get("expenseDate")?.trim();if(!r)return{error:"Project is required"};let d=t.getAll("materialId"),c=t.getAll("qty"),u=t.getAll("unitPrice"),m=new Map((await l._.materialCatalog.findMany({where:{tenantId:a.id},select:{id:!0,name:!0}})).map(e=>[e.id,e.name])),p=[];for(let e=0;e<d.length;e++){let t=(d[e]??"").trim(),a=t?m.get(t)??"":"",r=parseFloat(String(c[e]??"0")),n=parseFloat(String(u[e]??"0"));!(!t&&(Number.isNaN(r)||0===r)&&(Number.isNaN(n)||0===n))&&(Number.isNaN(r)||r<0||Number.isNaN(n)||n<0||p.push({materials:a||"Item",quantity:r,unitPrice:n}))}if(0===p.length)return{error:"Add at least one item with quantity and unit price"};let x=p.reduce((e,t)=>e+t.quantity*t.unitPrice,0),h=o?new Date(o):new Date;if(!await l._.project.findFirst({where:{id:r,tenantId:a.id}}))return{error:"Project not found"};let b=1===p.length&&"Item"!==p[0].materials?p[0].materials:`Daily expenses (${p.length} items)`;await l._.$transaction(async e=>{let t=await e.expense.create({data:{tenantId:a.id,projectId:r,title:b,amount:x,quantity:null,unitCost:null,category:"MATERIAL",expenseDate:h}});await e.expenseItem.createMany({data:p.map(e=>({expenseId:t.id,materials:e.materials,quantity:e.quantity,unitPrice:e.unitPrice}))})}),(0,s.revalidatePath)("/expenses"),(0,s.revalidatePath)("/dashboard"),(0,s.revalidatePath)(`/projects/${r}`),(0,n.redirect)(`/projects/${r}`)}(0,a(85723).h)([o]),(0,r.j)("c836c9d73feae8b3a4f73009e94fc74adf313489",o)},58614:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(19510),n=a(71613),s=a(13538);let i=(0,a(68570).createProxy)(String.raw`C:\construction\src\app\(tenant)\(app)\expenses\expense-form.tsx#ExpenseForm`);async function l({searchParams:e}){let t=await (0,n.n)(),{projectId:a}=await e,[l,o]=await Promise.all([s._.project.findMany({where:{tenantId:t.id},orderBy:{name:"asc"},select:{id:!0,name:!0}}),s._.materialCatalog.findMany({where:{tenantId:t.id},orderBy:{name:"asc"},select:{id:!0,name:!0,unit:!0,category:!0}})]);return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h1",{className:"page-title",children:"Add expense"}),r.jsx("p",{className:"page-subtitle",children:"Record materials, labor, or other costs for a project"}),r.jsx(i,{projects:l,materials:o,defaultProjectId:a??void 0})]})}},94635:(e,t,a)=>{"use strict";a.r(t),a.d(t,{createMaterialAction:()=>o,createMaterialAndReturnAction:()=>d});var r=a(27745);a(26461);var n=a(74739),s=a(30207),i=a(28516),l=a(24831);async function o(e,t){let a=await (0,i.n)(),r=t.get("name")?.trim(),o=t.get("unit")?.trim(),d=t.get("category")?.trim()||null;if(!r||!o)return{error:"Name and unit required"};if(await l._.materialCatalog.findFirst({where:{tenantId:a.id,name:r}}))return{error:"A material with this name already exists"};try{await l._.materialCatalog.create({data:{tenantId:a.id,name:r,unit:o,category:d}})}catch(e){if(e&&"object"==typeof e&&"code"in e&&"P2002"===e.code)return{error:"A material with this name already exists"};throw e}(0,s.revalidatePath)("/materials"),(0,n.redirect)("/materials")}async function d(e,t){let a=await (0,i.n)(),r=t.get("name")?.trim(),n=t.get("unit")?.trim(),o=t.get("category")?.trim()||null;if(!r||!n)return{error:"Name and unit required"};if(await l._.materialCatalog.findFirst({where:{tenantId:a.id,name:r}}))return{error:"A material with this name already exists"};try{let e=await l._.materialCatalog.create({data:{tenantId:a.id,name:r,unit:n,category:o}});return(0,s.revalidatePath)("/materials"),(0,s.revalidatePath)("/expenses/new"),{material:{id:e.id,name:e.name,unit:e.unit,category:e.category}}}catch(e){if(e&&"object"==typeof e&&"code"in e&&"P2002"===e.code)return{error:"A material with this name already exists"};throw e}}(0,a(85723).h)([o,d]),(0,r.j)("2b4dd5eb7f67e7f5c4ddb6afd53120597cfafbe4",o),(0,r.j)("3b5e7cf91495eec4540062b08cad32ac116c81f6",d)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,471,28,740,404,242,207,436],()=>a(86754));module.exports=r})();